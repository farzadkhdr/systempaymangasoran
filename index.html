<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستەمی مارکێت</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #1abc9c;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --gray: #95a5a6;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo img {
            height: 40px;
        }

        .logo h1 {
            font-size: 1.5rem;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 10px;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 4px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        nav ul li a:hover, nav ul li a.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Login Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .login-form {
            background: white;
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 400px;
            animation: fadeIn 0.5s ease;
        }

        .login-form h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--dark);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .btn {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            text-align: center;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn-success {
            background: var(--secondary);
        }

        .btn-success:hover {
            background: #27ae60;
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-warning:hover {
            background: #d35400;
        }

        .btn-info {
            background: var(--info);
        }

        .btn-info:hover {
            background: #16a085;
        }

        /* Main Content */
        .main-content {
            padding: 2rem 0;
        }

        .section-title {
            margin-bottom: 1.5rem;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: white;
            border-radius: var(--radius) var(--radius) 0 0;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            background: var(--primary);
            color: white;
            border-bottom: 3px solid var(--dark);
        }

        .tab:hover:not(.active) {
            background: #f1f1f1;
        }

        .tab-content {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 0 0 var(--radius) var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        /* Dashboard Styles */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
            border-left: 4px solid var(--primary);
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--gray);
        }

        .card .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--dark);
        }

        .card i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        /* Table Styles */
        .table-container {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f9f9f9;
        }

        /* Form Styles */
        .form-container {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }

        .form-col {
            flex: 1;
            padding: 0 10px;
            min-width: 200px;
            margin-bottom: 1rem;
        }

        /* Search Styles */
        .search-container {
            position: relative;
            margin-bottom: 1rem;
        }

        .search-input {
            width: 100%;
            padding: 10px 40px 10px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .search-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
        }

        /* Cart Styles */
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cart-item-image {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px;
            background: #f1f1f1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #777;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
            animation: slideIn 0.3s ease;
        }

        .modal-header {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--primary);
            color: white;
            border-radius: var(--radius) var(--radius) 0 0;
        }

        .modal-body {
            padding: 1rem;
        }

        .modal-footer {
            padding: 1rem;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .close {
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Invoice Styles */
        .invoice {
            padding: 20px;
            border: 1px solid #ddd;
            background: white;
            max-width: 800px;
            margin: 0 auto;
        }

        .invoice-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
        }

        .invoice-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .invoice-items {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .invoice-items th {
            background: #f1f1f1;
            color: var(--dark);
        }

        .invoice-total {
            text-align: left;
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
            }

            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }

            nav ul li {
                margin: 5px;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .form-row {
                flex-direction: column;
            }

            .form-col {
                margin-bottom: 1rem;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .badge-success {
            background: var(--secondary);
            color: white;
        }

        .badge-danger {
            background: var(--danger);
            color: white;
        }

        .badge-warning {
            background: var(--warning);
            color: white;
        }

        /* Alert */
        .alert {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* Customer List */
        .customer-card {
            background: white;
            border-radius: var(--radius);
            padding: 1rem;
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .customer-info h3 {
            margin-bottom: 5px;
        }

        .customer-actions {
            display: flex;
            gap: 10px;
        }

        /* Settings */
        .settings-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
        }

        .settings-card h3 {
            margin-bottom: 1rem;
            color: var(--dark);
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        /* User Management */
        .user-card {
            background: white;
            border-radius: var(--radius);
            padding: 1rem;
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info h3 {
            margin-bottom: 5px;
        }

        .user-role {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            background: var(--info);
            color: white;
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-form">
            <h2><i class="fas fa-store"></i> چوونەژوورەوە بۆ سیستەمی مارکێت</h2>
            <div class="form-group">
                <label for="username"><i class="fas fa-user"></i> ناوی بەکارهێنەر</label>
                <input type="text" id="username" placeholder="ناوی بەکارهێنەر">
            </div>
            <div class="form-group">
                <label for="password"><i class="fas fa-lock"></i> پاسوۆرد</label>
                <input type="password" id="password" placeholder="پاسوۆرد">
            </div>
            <button id="loginBtn" class="btn btn-success" style="width: 100%;">
                <i class="fas fa-sign-in-alt"></i> چوونەژوورەوە
            </button>
            <div id="loginMessage" class="alert alert-danger" style="display: none;"></div>
        </div>
    </div>

    <!-- Main Application (Hidden until login) -->
    <div id="app" style="display: none;">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <div style="width: 40px; height: 40px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-store" style="color: var(--primary); font-size: 1.5rem;"></i>
                        </div>
                        <h1 id="systemName">سیستەمی مارکێت</h1>
                    </div>
                    <nav>
                        <ul>
                            <li><a href="#" data-section="dashboard" class="active"><i class="fas fa-tachometer-alt"></i> داشبۆرد</a></li>
                            <li><a href="#" data-section="sales"><i class="fas fa-shopping-cart"></i> فرۆشتن</a></li>
                            <li><a href="#" data-section="inventory"><i class="fas fa-boxes"></i> مخزن</a></li>
                            <li><a href="#" data-section="purchases"><i class="fas fa-shopping-bag"></i> کڕین</a></li>
                            <li><a href="#" data-section="customers"><i class="fas fa-users"></i> کەسەکان</a></li>
                            <li><a href="#" data-section="settings"><i class="fas fa-cog"></i> رێکخستن</a></li>
                        </ul>
                    </nav>
                    <div class="user-info">
                        <span id="currentUser">farzad</span>
                        <button id="logoutBtn" class="btn btn-danger"><i class="fas fa-sign-out-alt"></i> دەرچوون</button>
                    </div>
                </div>
            </div>
        </header>

        <main class="main-content">
            <div class="container">
                <!-- Dashboard Section -->
                <section id="dashboard" class="section">
                    <h2 class="section-title"><i class="fas fa-tachometer-alt"></i> داشبۆرد</h2>
                    
                    <div class="dashboard-cards">
                        <div class="card">
                            <i class="fas fa-chart-line"></i>
                            <h3>کۆی فرۆشتن</h3>
                            <div class="value" id="totalSales">0 دینار</div>
                        </div>
                        <div class="card">
                            <i class="fas fa-money-bill-wave"></i>
                            <h3>کۆی کڕین</h3>
                            <div class="value" id="totalPurchases">0 دینار</div>
                        </div>
                        <div class="card">
                            <i class="fas fa-hand-holding-usd"></i>
                            <h3>کۆی قەرزداران</h3>
                            <div class="value" id="totalDebt">0 دینار</div>
                        </div>
                        <div class="card">
                            <i class="fas fa-boxes"></i>
                            <h3>کۆی کاڵاکان</h3>
                            <div class="value" id="totalProducts">0</div>
                        </div>
                    </div>

                    <div class="tabs">
                        <div class="tab active" data-tab="debtors">کەسە قەرزدارەکان</div>
                        <div class="tab" data-tab="recentSales">دواین فرۆشتنەکان</div>
                        <div class="tab" data-tab="lowStock">کاڵای کەم</div>
                    </div>

                    <div class="tab-content active" id="debtorsTab">
                        <table>
                            <thead>
                                <tr>
                                    <th>ناو</th>
                                    <th>رەسید</th>
                                    <th>بڕی قەرز</th>
                                    <th>کردارەکان</th>
                                </tr>
                            </thead>
                            <tbody id="debtorsTable">
                                <!-- Data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <div class="tab-content" id="recentSalesTab">
                        <table>
                            <thead>
                                <tr>
                                    <th>کۆدی فاکتوور</th>
                                    <th>کەس</th>
                                    <th>بڕ</th>
                                    <th>بەروار</th>
                                </tr>
                            </thead>
                            <tbody id="recentSalesTable">
                                <!-- Data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <div class="tab-content" id="lowStockTab">
                        <table>
                            <thead>
                                <tr>
                                    <th>کاڵا</th>
                                    <th>بڕی ماوە</th>
                                    <th>یەکە</th>
                                    <th>کردارەکان</th>
                                </tr>
                            </thead>
                            <tbody id="lowStockTable">
                                <!-- Data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Sales Section -->
                <section id="sales" class="section" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-shopping-cart"></i> فرۆشتن</h2>
                    
                    <div class="form-container">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="productSearch">گەڕان بەدوای کاڵا</label>
                                <div class="search-container">
                                    <input type="text" id="productSearch" class="search-input" placeholder="ناوی کاڵا یان بارکۆد...">
                                    <span class="search-icon"><i class="fas fa-search"></i></span>
                                </div>
                                <div id="productSuggestions" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; display: none;">
                                    <!-- Product suggestions will appear here -->
                                </div>
                            </div>
                            <div class="form-col">
                                <label for="customerSearch">گەڕان بەدوای کەس</label>
                                <div class="search-container">
                                    <input type="text" id="customerSearch" class="search-input" placeholder="ناوی کەس...">
                                    <span class="search-icon"><i class="fas fa-search"></i></span>
                                </div>
                                <div id="customerSuggestions" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; display: none;">
                                    <!-- Customer suggestions will appear here -->
                                </div>
                            </div>
                            <div class="form-col">
                                <label for="paymentMethod">شێوازی پارەدان</label>
                                <select id="paymentMethod" class="form-control">
                                    <option value="cash">نەقدی</option>
                                    <option value="credit">قەرز</option>
                                </select>
                            </div>
                            <div class="form-col" style="display: flex; align-items: flex-end;">
                                <button id="addToCartBtn" class="btn" style="width: 100%;">
                                    <i class="fas fa-cart-plus"></i> زیادکردن بۆ سەبەتە
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <h3 style="padding: 15px; background: var(--light);">
                            <i class="fas fa-shopping-basket"></i> سەبەتە
                        </h3>
                        <div id="cartItems">
                            <!-- Cart items will appear here -->
                        </div>
                        <div style="padding: 15px; display: flex; justify-content: space-between; align-items: center; background: #f9f9f9;">
                            <div>
                                <strong>کۆی گشتی: <span id="cartTotal">0</span> دینار</strong>
                            </div>
                            <div>
                                <button id="finalizeSaleBtn" class="btn btn-success">
                                    <i class="fas fa-check-circle"></i> تەواوکردنی فرۆشتن
                                </button>
                                <button id="clearCartBtn" class="btn btn-danger">
                                    <i class="fas fa-trash"></i> پاککردنەوەی سەبەتە
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <h3 style="padding: 15px; background: var(--light);">
                            <i class="fas fa-history"></i> مێژووی فرۆشتن
                        </h3>
                        <div class="search-container" style="margin: 15px;">
                            <input type="text" id="salesHistorySearch" class="search-input" placeholder="گەڕان بەدوای کەس یان کۆدی فاکتوور...">
                            <span class="search-icon"><i class="fas fa-search"></i></span>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>کۆدی فاکتوور</th>
                                    <th>کەس</th>
                                    <th>بڕ</th>
                                    <th>بەروار</th>
                                    <th>شێوازی پارەدان</th>
                                    <th>کردارەکان</th>
                                </tr>
                            </thead>
                            <tbody id="salesHistoryTable">
                                <!-- Sales history will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Inventory Section -->
                <section id="inventory" class="section" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-boxes"></i> مخزن</h2>
                    
                    <div class="form-container">
                        <h3 style="margin-bottom: 1rem;">زیادکردنی کاڵای نوێ</h3>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="productName">ناوی کاڵا</label>
                                <input type="text" id="productName" class="form-control" placeholder="ناوی کاڵا">
                            </div>
                            <div class="form-col">
                                <label for="productBarcode">بارکۆد</label>
                                <input type="text" id="productBarcode" class="form-control" placeholder="بارکۆد">
                            </div>
                            <div class="form-col">
                                <label for="productUnit">یەکە</label>
                                <select id="productUnit" class="form-control">
                                    <option value="دانە">دانە</option>
                                    <option value="کیلۆ">کیلۆ</option>
                                    <option value="مەتر">مەتر</option>
                                    <option value="لیتر">لیتر</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="productQuantity">بڕ</label>
                                <input type="number" id="productQuantity" class="form-control" placeholder="بڕ" min="0">
                            </div>
                            <div class="form-col">
                                <label for="productPurchasePrice">نرخی کڕین</label>
                                <input type="number" id="productPurchasePrice" class="form-control" placeholder="نرخی کڕین" min="0" step="0.01">
                            </div>
                            <div class="form-col">
                                <label for="productSalePrice">نرخی فرۆشتن</label>
                                <input type="number" id="productSalePrice" class="form-control" placeholder="نرخی فرۆشتن" min="0" step="0.01">
                            </div>
                            <div class="form-col">
                                <label for="productCartonSize">قەبارەی کارتۆن (ئەگەر هەیە)</label>
                                <input type="number" id="productCartonSize" class="form-control" placeholder="چەند دانە" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <button id="addProductBtn" class="btn btn-success" style="width: 100%;">
                                    <i class="fas fa-plus"></i> زیادکردنی کاڵا
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <h3 style="padding: 15px; background: var(--light);">
                            <i class="fas fa-list"></i> لیستی کاڵاکان
                        </h3>
                        <div class="search-container" style="margin: 15px;">
                            <input type="text" id="inventorySearch" class="search-input" placeholder="گەڕان بەدوای کاڵا...">
                            <span class="search-icon"><i class="fas fa-search"></i></span>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ناوی کاڵا</th>
                                    <th>بارکۆد</th>
                                    <th>بڕی ماوە</th>
                                    <th>یەکە</th>
                                    <th>نرخی کڕین</th>
                                    <th>نرخی فرۆشتن</th>
                                    <th>کردارەکان</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTable">
                                <!-- Inventory items will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Purchases Section -->
                <section id="purchases" class="section" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-shopping-bag"></i> کڕین</h2>
                    
                    <div class="form-container">
                        <h3 style="margin-bottom: 1rem;">تۆمارکردنی کڕین</h3>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="purchaseProductSearch">گەڕان بەدوای کاڵا</label>
                                <div class="search-container">
                                    <input type="text" id="purchaseProductSearch" class="search-input" placeholder="ناوی کاڵا...">
                                    <span class="search-icon"><i class="fas fa-search"></i></span>
                                </div>
                                <div id="purchaseProductSuggestions" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; display: none;">
                                    <!-- Product suggestions will appear here -->
                                </div>
                            </div>
                            <div class="form-col">
                                <label for="purchaseQuantity">بڕی کڕین</label>
                                <input type="number" id="purchaseQuantity" class="form-control" placeholder="بڕ" min="1">
                            </div>
                            <div class="form-col">
                                <label for="purchasePrice">نرخی کڕین</label>
                                <input type="number" id="purchasePrice" class="form-control" placeholder="نرخ" min="0" step="0.01">
                            </div>
                            <div class="form-col" style="display: flex; align-items: flex-end;">
                                <button id="addPurchaseBtn" class="btn btn-success" style="width: 100%;">
                                    <i class="fas fa-plus"></i> زیادکردنی کڕین
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <h3 style="padding: 15px; background: var(--light);">
                            <i class="fas fa-list"></i> کڕینەکان
                        </h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>کاڵا</th>
                                    <th>بڕ</th>
                                    <th>نرخ</th>
                                    <th>کۆی</th>
                                    <th>بەروار</th>
                                    <th>کردارەکان</th>
                                </tr>
                            </thead>
                            <tbody id="purchasesTable">
                                <!-- Purchases will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Customers Section -->
                <section id="customers" class="section" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-users"></i> کەسەکان</h2>
                    
                    <div class="form-container">
                        <h3 style="margin-bottom: 1rem;">زیادکردنی کەسی نوێ</h3>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="customerName">ناوی کەس</label>
                                <input type="text" id="customerName" class="form-control" placeholder="ناوی کەس">
                            </div>
                            <div class="form-col">
                                <label for="customerPhone">ژمارەی مۆبایل</label>
                                <input type="text" id="customerPhone" class="form-control" placeholder="ژمارەی مۆبایل">
                            </div>
                            <div class="form-col">
                                <label for="customerInitialDebt">بڕی قەرز (سەرەتا)</label>
                                <input type="number" id="customerInitialDebt" class="form-control" placeholder="بڕی قەرز" min="0" value="0">
                            </div>
                            <div class="form-col" style="display: flex; align-items: flex-end;">
                                <button id="addCustomerBtn" class="btn btn-success" style="width: 100%;">
                                    <i class="fas fa-plus"></i> زیادکردنی کەس
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <h3 style="padding: 15px; background: var(--light);">
                            <i class="fas fa-list"></i> لیستی کەسەکان
                        </h3>
                        <div class="search-container" style="margin: 15px;">
                            <input type="text" id="customersSearch" class="search-input" placeholder="گەڕان بەدوای کەس...">
                            <span class="search-icon"><i class="fas fa-search"></i></span>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ناو</th>
                                    <th>رەسید</th>
                                    <th>ژمارەی مۆبایل</th>
                                    <th>قەرز</th>
                                    <th>کردارەکان</th>
                                </tr>
                            </thead>
                            <tbody id="customersTable">
                                <!-- Customers will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <!-- دوو کلیکی نوێ بۆ پارە وەسڵکردن و مێژووی پارەدان -->
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button id="showPaymentModalBtn" class="btn btn-success">
                            <i class="fas fa-money-bill-wave"></i> پارە وەسڵ کردن
                        </button>
                        <button id="showPaymentHistoryBtn" class="btn btn-info">
                            <i class="fas fa-history"></i> مێژووی پارە وەسڵ کردن
                        </button>
                    </div>
                </section>

                <!-- Settings Section -->
                <section id="settings" class="section" style="display: none;">
                    <h2 class="section-title"><i class="fas fa-cog"></i> رێکخستن</h2>
                    
                    <div class="settings-card">
                        <h3><i class="fas fa-store"></i> سیستەم</h3>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="systemNameInput">ناوی سیستەم</label>
                                <input type="text" id="systemNameInput" class="form-control" placeholder="ناوی سیستەم">
                            </div>
                            <div class="form-col">
                                <label for="systemLogo">لۆگۆی سیستەم</label>
                                <input type="file" id="systemLogo" class="form-control" accept="image/*">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <button id="saveSystemSettingsBtn" class="btn btn-success">
                                    <i class="fas fa-save"></i> پاشکەوتکردنی رێکخستنەکان
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-key"></i> گۆڕینی پاسوۆرد</h3>
                        <div class="form-row">
                            <div class="form-col">
                                <label for="currentPassword">پاسوۆردی ئێستا</label>
                                <input type="password" id="currentPassword" class="form-control" placeholder="پاسوۆردی ئێستا">
                            </div>
                            <div class="form-col">
                                <label for="newPassword">پاسوۆردی نوێ</label>
                                <input type="password" id="newPassword" class="form-control" placeholder="پاسوۆردی نوێ">
                            </div>
                            <div class="form-col">
                                <label for="confirmPassword">دووبارەکردنەوەی پاسوۆرد</label>
                                <input type="password" id="confirmPassword" class="form-control" placeholder="دووبارەکردنەوەی پاسوۆرد">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <button id="changePasswordBtn" class="btn btn-success">
                                    <i class="fas fa-save"></i> گۆڕینی پاسوۆرد
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-database"></i> باکەپ</h3>
                        <div class="form-row">
                            <div class="form-col">
                                <button id="backupBtn" class="btn btn-info">
                                    <i class="fas fa-download"></i> وەشاندنی باکەپ
                                </button>
                            </div>
                            <div class="form-col">
                                <label for="restoreBackup">گەڕاندنەوەی باکەپ</label>
                                <input type="file" id="restoreBackup" class="form-control" accept=".json">
                            </div>
                            <div class="form-col" style="display: flex; align-items: flex-end;">
                                <button id="restoreBtn" class="btn btn-warning">
                                    <i class="fas fa-upload"></i> گەڕاندنەوەی باکەپ
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-users-cog"></i> بەڕیوەبردنی بەکارهێنەران</h3>
                        <div class="form-container">
                            <h4 style="margin-bottom: 1rem;">زیادکردنی بەکارهێنەری نوێ</h4>
                            <div class="form-row">
                                <div class="form-col">
                                    <label for="newUsername">ناوی بەکارهێنەر</label>
                                    <input type="text" id="newUsername" class="form-control" placeholder="ناوی بەکارهێنەر">
                                </div>
                                <div class="form-col">
                                    <label for="newUserPassword">پاسوۆرد</label>
                                    <input type="password" id="newUserPassword" class="form-control" placeholder="پاسوۆرد">
                                </div>
                                <div class="form-col">
                                    <label for="newUserRole">رۆڵ</label>
                                    <select id="newUserRole" class="form-control">
                                        <option value="user">بەکارهێنەر</option>
                                        <option value="admin">ئەدمین</option>
                                    </select>
                                </div>
                                <div class="form-col" style="display: flex; align-items: flex-end;">
                                    <button id="addUserBtn" class="btn btn-success" style="width: 100%;">
                                        <i class="fas fa-plus"></i> زیادکردنی بەکارهێنەر
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="table-container" style="margin-top: 1.5rem;">
                            <h4 style="padding: 15px; background: var(--light);">لیستی بەکارهێنەران</h4>
                            <table>
                                <thead>
                                    <tr>
                                        <th>ناوی بەکارهێنەر</th>
                                        <th>رۆڵ</th>
                                        <th>کردارەکان</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTable">
                                    <!-- Users will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
                
                <!-- Developer Info -->
                <div style="text-align: center; margin-top: 3rem; padding: 1.5rem; background: white; border-radius: var(--radius); box-shadow: var(--shadow);">
                    <p style="font-size: 1.2rem; font-weight: bold; color: var(--dark);">
                        <i class="fas fa-code"></i> developer farzad
                    </p>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal for invoice details -->
    <div id="invoiceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-receipt"></i> وردەکاری فاکتوور</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body" id="invoiceModalBody">
                <!-- Invoice details will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button class="btn" id="printInvoiceBtn"><i class="fas fa-print"></i> چاپکردن</button>
                <button class="btn btn-warning" id="editInvoiceBtn"><i class="fas fa-edit"></i> دەستکاری</button>
                <button class="btn btn-danger" id="deleteInvoiceBtn"><i class="fas fa-trash"></i> سڕینەوە</button>
            </div>
        </div>
    </div>

    <!-- Modal for payment -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-money-bill-wave"></i> پارە وەسڵکردن</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body" id="paymentModalBody">
                <!-- Payment details will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" id="confirmPaymentBtn"><i class="fas fa-check"></i> پشتڕاستکردنەوە</button>
                <button class="btn btn-danger" id="cancelPaymentBtn"><i class="fas fa-times"></i> پاشگەزبوونەوە</button>
            </div>
        </div>
    </div>

    <!-- Modal for payment history -->
    <div id="paymentHistoryModal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h3><i class="fas fa-history"></i> مێژووی پارە وەسڵ کردن</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body" id="paymentHistoryModalBody">
                <!-- Payment history will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button class="btn" id="printPaymentHistoryBtn"><i class="fas fa-print"></i> چاپکردن</button>
                <button class="btn btn-danger" id="closePaymentHistoryBtn">داخستن</button>
            </div>
        </div>
    </div>

    <script>
        // Sample data for demonstration
        const sampleData = {
            users: [
                { username: 'farzad', password: 'farzad1234', role: 'admin' },
                { username: 'user1', password: 'user11234', role: 'user' }
            ],
            products: [
                { id: 1, name: 'شەکر', barcode: '123456', quantity: 100, unit: 'کیلۆ', purchasePrice: 500, salePrice: 600, image: '', cartonSize: 0 },
                { id: 2, name: 'برنج', barcode: '789012', quantity: 50, unit: 'کیلۆ', purchasePrice: 1500, salePrice: 1800, image: '', cartonSize: 0 },
                { id: 3, name: 'چای', barcode: '345678', quantity: 200, unit: 'دانە', purchasePrice: 200, salePrice: 250, image: '', cartonSize: 50 },
                { id: 4, name: 'رۆن', barcode: '901234', quantity: 30, unit: 'لیتر', purchasePrice: 800, salePrice: 1000, image: '', cartonSize: 0 },
                { id: 5, name: 'شامپۆ', barcode: '567890', quantity: 5, unit: 'دانە', purchasePrice: 1200, salePrice: 1500, image: '', cartonSize: 12 }
            ],
            customers: [
                { id: 1, name: 'عەلی', receipt: 'R001', debt: 15000, phone: '07501234567' },
                { id: 2, name: 'حەسەن', receipt: 'R002', debt: 0, phone: '07507654321' },
                { id: 3, name: 'مەحموود', receipt: 'R003', debt: 7500, phone: '07501112233' },
                { id: 4, name: 'سەلام', receipt: 'R004', debt: 0, phone: '07504445566' }
            ],
            sales: [
                { id: 1, customerId: 1, date: '2023-10-01', total: 25000, paymentMethod: 'credit', items: [
                    { productId: 1, name: 'شەکر', quantity: 10, unit: 'کیلۆ', price: 600, total: 6000 },
                    { productId: 2, name: 'برنج', quantity: 5, unit: 'کیلۆ', price: 1800, total: 9000 },
                    { productId: 3, name: 'چای', quantity: 40, unit: 'دانە', price: 250, total: 10000 }
                ]},
                { id: 2, customerId: 3, date: '2023-10-02', total: 12500, paymentMethod: 'credit', items: [
                    { productId: 3, name: 'چای', quantity: 50, unit: 'دانە', price: 250, total: 12500 }
                ]},
                { id: 3, customerId: null, date: '2023-10-03', total: 3000, paymentMethod: 'cash', items: [
                    { productId: 4, name: 'رۆن', quantity: 3, unit: 'لیتر', price: 1000, total: 3000 }
                ]}
            ],
            purchases: [
                { id: 1, productId: 1, productName: 'شەکر', quantity: 100, unit: 'کیلۆ', price: 500, total: 50000, date: '2023-09-15' },
                { id: 2, productId: 2, productName: 'برنج', quantity: 50, unit: 'کیلۆ', price: 1500, total: 75000, date: '2023-09-20' },
                { id: 3, productId: 3, productName: 'چای', quantity: 200, unit: 'دانە', price: 200, total: 40000, date: '2023-09-25' }
            ],
            payments: [
                { id: 1, customerId: 1, customerName: 'عەلی', date: '2023-10-05', amount: 5000, previousDebt: 20000, newDebt: 15000 },
                { id: 2, customerId: 3, customerName: 'مەحموود', date: '2023-10-06', amount: 2500, previousDebt: 10000, newDebt: 7500 }
            ],
            system: {
                name: 'سیستەمی مارکێت',
                logo: ''
            }
        };

        // Application state
        let currentUser = null;
        let cart = [];
        let currentSection = 'dashboard';
        let currentTab = 'debtors';
        let editingInvoiceId = null;
        let currentEditingCustomerId = null;

        // DOM elements
        const loginScreen = document.getElementById('loginScreen');
        const app = document.getElementById('app');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginMessage = document.getElementById('loginMessage');
        const currentUserSpan = document.getElementById('currentUser');
        const systemName = document.getElementById('systemName');
        const sectionLinks = document.querySelectorAll('nav a[data-section]');
        const sections = document.querySelectorAll('.section');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Sales section elements
        const productSearch = document.getElementById('productSearch');
        const customerSearch = document.getElementById('customerSearch');
        const paymentMethod = document.getElementById('paymentMethod');
        const productSuggestions = document.getElementById('productSuggestions');
        const customerSuggestions = document.getElementById('customerSuggestions');
        const addToCartBtn = document.getElementById('addToCartBtn');
        const clearCartBtn = document.getElementById('clearCartBtn');
        const cartItems = document.getElementById('cartItems');
        const cartTotal = document.getElementById('cartTotal');
        const finalizeSaleBtn = document.getElementById('finalizeSaleBtn');
        const salesHistorySearch = document.getElementById('salesHistorySearch');
        const salesHistoryTable = document.getElementById('salesHistoryTable');
        
        // Dashboard elements
        const debtorsTable = document.getElementById('debtorsTable');
        const recentSalesTable = document.getElementById('recentSalesTable');
        const lowStockTable = document.getElementById('lowStockTable');
        const totalSales = document.getElementById('totalSales');
        const totalPurchases = document.getElementById('totalPurchases');
        const totalDebt = document.getElementById('totalDebt');
        const totalProducts = document.getElementById('totalProducts');
        
        // Inventory elements
        const productName = document.getElementById('productName');
        const productBarcode = document.getElementById('productBarcode');
        const productUnit = document.getElementById('productUnit');
        const productQuantity = document.getElementById('productQuantity');
        const productPurchasePrice = document.getElementById('productPurchasePrice');
        const productSalePrice = document.getElementById('productSalePrice');
        const productCartonSize = document.getElementById('productCartonSize');
        const addProductBtn = document.getElementById('addProductBtn');
        const inventorySearch = document.getElementById('inventorySearch');
        const inventoryTable = document.getElementById('inventoryTable');
        
        // Purchases elements
        const purchaseProductSearch = document.getElementById('purchaseProductSearch');
        const purchaseQuantity = document.getElementById('purchaseQuantity');
        const purchasePrice = document.getElementById('purchasePrice');
        const addPurchaseBtn = document.getElementById('addPurchaseBtn');
        const purchasesTable = document.getElementById('purchasesTable');
        const purchaseProductSuggestions = document.getElementById('purchaseProductSuggestions');
        
        // Customers elements
        const customerName = document.getElementById('customerName');
        const customerPhone = document.getElementById('customerPhone');
        const customerInitialDebt = document.getElementById('customerInitialDebt');
        const addCustomerBtn = document.getElementById('addCustomerBtn');
        const customersSearch = document.getElementById('customersSearch');
        const customersTable = document.getElementById('customersTable');
        
        // Settings elements
        const systemNameInput = document.getElementById('systemNameInput');
        const systemLogo = document.getElementById('systemLogo');
        const saveSystemSettingsBtn = document.getElementById('saveSystemSettingsBtn');
        const currentPassword = document.getElementById('currentPassword');
        const newPassword = document.getElementById('newPassword');
        const confirmPassword = document.getElementById('confirmPassword');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const backupBtn = document.getElementById('backupBtn');
        const restoreBackup = document.getElementById('restoreBackup');
        const restoreBtn = document.getElementById('restoreBtn');
        const newUsername = document.getElementById('newUsername');
        const newUserPassword = document.getElementById('newUserPassword');
        const newUserRole = document.getElementById('newUserRole');
        const addUserBtn = document.getElementById('addUserBtn');
        const usersTable = document.getElementById('usersTable');
        
        // Modal elements
        const invoiceModal = document.getElementById('invoiceModal');
        const paymentModal = document.getElementById('paymentModal');
        const closeModalButtons = document.querySelectorAll('.close');
        const invoiceModalBody = document.getElementById('invoiceModalBody');
        const paymentModalBody = document.getElementById('paymentModalBody');
        const printInvoiceBtn = document.getElementById('printInvoiceBtn');
        const editInvoiceBtn = document.getElementById('editInvoiceBtn');
        const deleteInvoiceBtn = document.getElementById('deleteInvoiceBtn');
        const confirmPaymentBtn = document.getElementById('confirmPaymentBtn');
        const cancelPaymentBtn = document.getElementById('cancelPaymentBtn');

        // دوو کلیکی نوێ
        const showPaymentModalBtn = document.getElementById('showPaymentModalBtn');
        const showPaymentHistoryBtn = document.getElementById('showPaymentHistoryBtn');
        const paymentHistoryModal = document.getElementById('paymentHistoryModal');
        const paymentHistoryModalBody = document.getElementById('paymentHistoryModalBody');
        const printPaymentHistoryBtn = document.getElementById('printPaymentHistoryBtn');
        const closePaymentHistoryBtn = document.getElementById('closePaymentHistoryBtn');

        // Initialize the application
        function init() {
            // Set system name
            systemName.textContent = sampleData.system.name;
            systemNameInput.value = sampleData.system.name;
            
            // Load data from localStorage if available
            loadDataFromStorage();
            
            // Set up event listeners
            setupEventListeners();
            
            // Update all displays
            updateAllDisplays();
        }

        // Load data from localStorage
        function loadDataFromStorage() {
            const storedData = localStorage.getItem('marketSystemData');
            if (storedData) {
                const parsedData = JSON.parse(storedData);
                Object.assign(sampleData, parsedData);
            }
        }

        // Save data to localStorage
        function saveDataToStorage() {
            localStorage.setItem('marketSystemData', JSON.stringify(sampleData));
        }

        // Set up event listeners
        function setupEventListeners() {
            // Login
            loginBtn.addEventListener('click', handleLogin);
            usernameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            
            // Logout
            logoutBtn.addEventListener('click', handleLogout);
            
            // Navigation
            sectionLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = link.getAttribute('data-section');
                    showSection(section);
                });
            });
            
            // Tabs
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    showTab(tabId);
                });
            });
            
            // Product search
            productSearch.addEventListener('input', handleProductSearch);
            
            // Customer search
            customerSearch.addEventListener('input', handleCustomerSearch);
            
            // Sales history search
            salesHistorySearch.addEventListener('input', updateSalesHistory);
            
            // Inventory search
            inventorySearch.addEventListener('input', updateInventoryTable);
            
            // Customers search
            customersSearch.addEventListener('input', updateCustomersTable);
            
            // Purchase product search
            purchaseProductSearch.addEventListener('input', handlePurchaseProductSearch);
            
            // Add to cart
            addToCartBtn.addEventListener('click', addToCart);
            
            // Clear cart
            clearCartBtn.addEventListener('click', clearCart);
            
            // Finalize sale
            finalizeSaleBtn.addEventListener('click', finalizeSale);
            
            // Add product
            addProductBtn.addEventListener('click', addProduct);
            
            // Add purchase
            addPurchaseBtn.addEventListener('click', addPurchase);
            
            // Add customer
            addCustomerBtn.addEventListener('click', addCustomer);
            
            // Settings
            saveSystemSettingsBtn.addEventListener('click', saveSystemSettings);
            changePasswordBtn.addEventListener('click', changePassword);
            backupBtn.addEventListener('click', backupData);
            restoreBtn.addEventListener('click', restoreData);
            addUserBtn.addEventListener('click', addUser);
            
            // Modals
            closeModalButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    invoiceModal.style.display = 'none';
                    paymentModal.style.display = 'none';
                    paymentHistoryModal.style.display = 'none';
                });
            });
            
            window.addEventListener('click', (e) => {
                if (e.target === invoiceModal) {
                    invoiceModal.style.display = 'none';
                }
                if (e.target === paymentModal) {
                    paymentModal.style.display = 'none';
                }
                if (e.target === paymentHistoryModal) {
                    paymentHistoryModal.style.display = 'none';
                }
            });
            
            // Print invoice
            printInvoiceBtn.addEventListener('click', printInvoice);
            
            // Edit invoice
            editInvoiceBtn.addEventListener('click', editInvoice);
            
            // Delete invoice
            deleteInvoiceBtn.addEventListener('click', deleteInvoice);
            
            // Payment
            confirmPaymentBtn.addEventListener('click', confirmPayment);
            cancelPaymentBtn.addEventListener('click', () => {
                paymentModal.style.display = 'none';
            });

            // Event listeners for new buttons
            showPaymentModalBtn.addEventListener('click', showPaymentModalForAnyCustomer);
            showPaymentHistoryBtn.addEventListener('click', showPaymentHistory);
            printPaymentHistoryBtn.addEventListener('click', printPaymentHistory);
            closePaymentHistoryBtn.addEventListener('click', () => {
                paymentHistoryModal.style.display = 'none';
            });
        }

        // Handle login
        function handleLogin() {
            const username = usernameInput.value;
            const password = passwordInput.value;
            
            const user = sampleData.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                currentUserSpan.textContent = user.username;
                loginScreen.style.display = 'none';
                app.style.display = 'block';
                loginMessage.style.display = 'none';
                
                // Show welcome message
                showAlert(`بەخێربێی ${user.username}!`, 'success');
            } else {
                loginMessage.textContent = 'ناوی بەکارهێنەر یان پاسوۆرد هەڵەیە!';
                loginMessage.style.display = 'block';
            }
        }

        // Handle logout
        function handleLogout() {
            currentUser = null;
            usernameInput.value = '';
            passwordInput.value = '';
            loginScreen.style.display = 'flex';
            app.style.display = 'none';
            cart = [];
            updateCart();
        }

        // Show section
        function showSection(section) {
            sections.forEach(s => s.style.display = 'none');
            document.getElementById(section).style.display = 'block';
            currentSection = section;
            
            // Update active nav link
            sectionLinks.forEach(link => {
                if (link.getAttribute('data-section') === section) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            
            // Update displays for the section
            if (section === 'dashboard') {
                updateDashboard();
            } else if (section === 'sales') {
                updateSalesHistory();
            } else if (section === 'inventory') {
                updateInventoryTable();
            } else if (section === 'purchases') {
                updatePurchasesTable();
            } else if (section === 'customers') {
                updateCustomersTable();
            } else if (section === 'settings') {
                updateUsersTable();
            }
        }

        // Show tab
        function showTab(tabId) {
            tabs.forEach(tab => {
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            tabContents.forEach(content => {
                if (content.id === `${tabId}Tab`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
            
            currentTab = tabId;
            
            // Update tab content
            if (tabId === 'debtors') {
                updateDebtorsTable();
            } else if (tabId === 'recentSales') {
                updateRecentSalesTable();
            } else if (tabId === 'lowStock') {
                updateLowStockTable();
            }
        }

        // Handle product search
        function handleProductSearch() {
            const query = productSearch.value.toLowerCase();
            
            if (query.length === 0) {
                productSuggestions.style.display = 'none';
                return;
            }
            
            const filteredProducts = sampleData.products.filter(product => 
                product.name.toLowerCase().includes(query) || 
                product.barcode.includes(query)
            );
            
            displayProductSuggestions(filteredProducts, productSuggestions);
        }

        // Handle purchase product search
        function handlePurchaseProductSearch() {
            const query = purchaseProductSearch.value.toLowerCase();
            
            if (query.length === 0) {
                purchaseProductSuggestions.style.display = 'none';
                return;
            }
            
            const filteredProducts = sampleData.products.filter(product => 
                product.name.toLowerCase().includes(query) || 
                product.barcode.includes(query)
            );
            
            displayProductSuggestions(filteredProducts, purchaseProductSuggestions);
        }

        // Display product suggestions
        function displayProductSuggestions(products, container) {
            container.innerHTML = '';
            
            if (products.length === 0) {
                container.style.display = 'none';
                return;
            }
            
            products.forEach(product => {
                const div = document.createElement('div');
                div.style.padding = '10px';
                div.style.borderBottom = '1px solid #eee';
                div.style.cursor = 'pointer';
                div.innerHTML = `
                    <div><strong>${product.name}</strong></div>
                    <div>نرخ: ${product.salePrice} دینار - بڕ: ${product.quantity} ${product.unit}</div>
                `;
                
                div.addEventListener('click', () => {
                    if (container === productSuggestions) {
                        productSearch.value = product.name;
                    } else {
                        purchaseProductSearch.value = product.name;
                        purchasePrice.value = product.purchasePrice;
                    }
                    container.style.display = 'none';
                });
                
                container.appendChild(div);
            });
            
            container.style.display = 'block';
        }

        // Handle customer search
        function handleCustomerSearch() {
            const query = customerSearch.value.toLowerCase();
            
            if (query.length === 0) {
                customerSuggestions.style.display = 'none';
                return;
            }
            
            const filteredCustomers = sampleData.customers.filter(customer => 
                customer.name.toLowerCase().includes(query) ||
                customer.receipt.includes(query)
            );
            
            displayCustomerSuggestions(filteredCustomers);
        }

        // Display customer suggestions
        function displayCustomerSuggestions(customers) {
            customerSuggestions.innerHTML = '';
            
            if (customers.length === 0) {
                customerSuggestions.style.display = 'none';
                return;
            }
            
            customers.forEach(customer => {
                const div = document.createElement('div');
                div.style.padding = '10px';
                div.style.borderBottom = '1px solid #eee';
                div.style.cursor = 'pointer';
                div.innerHTML = `
                    <div><strong>${customer.name}</strong></div>
                    <div>رەسید: ${customer.receipt} - قەرز: ${customer.debt} دینار</div>
                `;
                
                div.addEventListener('click', () => {
                    customerSearch.value = customer.name;
                    customerSuggestions.style.display = 'none';
                });
                
                customerSuggestions.appendChild(div);
            });
            
            customerSuggestions.style.display = 'block';
        }

        // Add to cart
        function addToCart() {
            const productNameValue = productSearch.value;
            
            if (!productNameValue) {
                showAlert('تکایە ناوی کاڵا بنووسە!', 'danger');
                return;
            }
            
            const product = sampleData.products.find(p => p.name === productNameValue);
            
            if (!product) {
                showAlert('کاڵا نەدۆزرایەوە!', 'danger');
                return;
            }
            
            // Check if product already in cart
            const existingItem = cart.find(item => item.productId === product.id);
            
            if (existingItem) {
                existingItem.quantity += 1;
                existingItem.total = existingItem.quantity * existingItem.price;
            } else {
                cart.push({
                    productId: product.id,
                    name: product.name,
                    quantity: 1,
                    unit: product.unit,
                    price: product.salePrice,
                    total: product.salePrice
                });
            }
            
            updateCart();
            productSearch.value = '';
            productSuggestions.style.display = 'none';
        }

        // Update cart display
        function updateCart() {
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<div style="padding: 20px; text-align: center;">سەبەتە بەتاڵە</div>';
                cartTotal.textContent = '0';
                return;
            }
            
            let total = 0;
            
            cart.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-image">
                            <i class="fas fa-box"></i>
                        </div>
                        <div>
                            <div><strong>${item.name}</strong></div>
                            <div>${item.price} دینار</div>
                        </div>
                    </div>
                    <div>
                        <input type="number" value="${item.quantity}" min="1" style="width: 60px; padding: 5px;" data-id="${item.productId}">
                        ${item.unit}
                    </div>
                    <div>${item.total} دینار</div>
                    <div>
                        <button class="btn btn-danger remove-from-cart" data-id="${item.productId}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                cartItems.appendChild(cartItem);
                total += item.total;
                
                // Add event listener for quantity change
                const quantityInput = cartItem.querySelector('input');
                quantityInput.addEventListener('change', (e) => {
                    const newQuantity = parseInt(e.target.value);
                    if (newQuantity > 0) {
                        item.quantity = newQuantity;
                        item.total = item.price * newQuantity;
                        updateCart();
                    }
                });
                
                // Add event listener for remove button
                const removeBtn = cartItem.querySelector('.remove-from-cart');
                removeBtn.addEventListener('click', () => {
                    cart = cart.filter(i => i.productId !== item.productId);
                    updateCart();
                });
            });
            
            cartTotal.textContent = total;
        }

        // Clear cart
        function clearCart() {
            if (cart.length === 0) return;
            
            if (confirm('دڵنیای لە پاککردنەوەی سەبەتە؟')) {
                cart = [];
                updateCart();
            }
        }

        // Finalize sale
        function finalizeSale() {
            if (cart.length === 0) {
                showAlert('سەبەتە بەتاڵە!', 'danger');
                return;
            }
            
            const customerName = customerSearch.value;
            const paymentMethodValue = paymentMethod.value;
            let customer = null;
            
            if (customerName) {
                customer = sampleData.customers.find(c => c.name === customerName);
                
                if (!customer) {
                    // Create new customer
                    customer = {
                        id: sampleData.customers.length + 1,
                        name: customerName,
                        receipt: `R${String(sampleData.customers.length + 1).padStart(3, '0')}`,
                        debt: 0,
                        phone: ''
                    };
                    sampleData.customers.push(customer);
                }
                
                // Check if customer has debt and payment is credit
                if (customer.debt > 0 && paymentMethodValue === 'credit') {
                    if (!confirm(`${customer.name} قەرزاری ${customer.debt} دینارە. ئایا دەتەوێ فرۆشتنەکە بکەیتە قەرز؟`)) {
                        return;
                    }
                }
            }
            
            // Calculate total
            const total = cart.reduce((sum, item) => sum + item.total, 0);
            
            // Check product quantities
            for (const item of cart) {
                const product = sampleData.products.find(p => p.id === item.productId);
                if (product.quantity < item.quantity) {
                    showAlert(`بڕی ${product.name} تەنها ${product.quantity} ${product.unit} ماوە!`, 'danger');
                    return;
                }
            }
            
            // Create sale record
            const sale = {
                id: sampleData.sales.length + 1,
                customerId: customer ? customer.id : null,
                date: new Date().toISOString().split('T')[0],
                total: total,
                paymentMethod: paymentMethodValue,
                items: [...cart]
            };
            
            sampleData.sales.push(sale);
            
            // Update customer debt if customer exists and payment is credit
            if (customer && paymentMethodValue === 'credit') {
                customer.debt += total;
            }
            
            // Update product quantities
            cart.forEach(item => {
                const product = sampleData.products.find(p => p.id === item.productId);
                if (product) {
                    product.quantity -= item.quantity;
                }
            });
            
            // Save data
            saveDataToStorage();
            
            // Reset cart and form
            cart = [];
            productSearch.value = '';
            customerSearch.value = '';
            paymentMethod.value = 'cash';
            updateCart();
            
            // Update displays
            updateAllDisplays();
            
            showAlert('فرۆشتن بە سەرکەوتویی تەواو بوو!', 'success');
        }

        // Add product
        function addProduct() {
            const name = productName.value;
            const barcode = productBarcode.value;
            const unit = productUnit.value;
            const quantity = parseInt(productQuantity.value) || 0;
            const purchasePrice = parseFloat(productPurchasePrice.value) || 0;
            const salePrice = parseFloat(productSalePrice.value) || 0;
            const cartonSize = parseInt(productCartonSize.value) || 0;
            
            if (!name) {
                showAlert('تکایە ناوی کاڵا بنووسە!', 'danger');
                return;
            }
            
            // Check if product with same name or barcode already exists
            const existingProduct = sampleData.products.find(p => 
                p.name === name || p.barcode === barcode
            );
            
            if (existingProduct) {
                showAlert('کاڵا بەم ناو یان بارکۆدە هەیە!', 'danger');
                return;
            }
            
            // Create new product
            const product = {
                id: sampleData.products.length + 1,
                name,
                barcode,
                quantity,
                unit,
                purchasePrice,
                salePrice,
                cartonSize,
                image: ''
            };
            
            sampleData.products.push(product);
            
            // Save data
            saveDataToStorage();
            
            // Reset form
            productName.value = '';
            productBarcode.value = '';
            productUnit.value = 'دانە';
            productQuantity.value = '';
            productPurchasePrice.value = '';
            productSalePrice.value = '';
            productCartonSize.value = '';
            
            // Update displays
            updateInventoryTable();
            updateDashboard();
            
            showAlert('کاڵا بە سەرکەوتویی زیاد کرا!', 'success');
        }

        // Add purchase
        function addPurchase() {
            const productNameValue = purchaseProductSearch.value;
            const quantity = parseInt(purchaseQuantity.value) || 0;
            const price = parseFloat(purchasePrice.value) || 0;
            
            if (!productNameValue) {
                showAlert('تکایە ناوی کاڵا بنووسە!', 'danger');
                return;
            }
            
            if (quantity <= 0) {
                showAlert('تکایە بڕێکی دروست بنووسە!', 'danger');
                return;
            }
            
            if (price <= 0) {
                showAlert('تکایە نرخێکی دروست بنووسە!', 'danger');
                return;
            }
            
            const product = sampleData.products.find(p => p.name === productNameValue);
            
            if (!product) {
                showAlert('کاڵا نەدۆزرایەوە!', 'danger');
                return;
            }
            
            // Create purchase record
            const purchase = {
                id: sampleData.purchases.length + 1,
                productId: product.id,
                productName: product.name,
                quantity,
                unit: product.unit,
                price,
                total: quantity * price,
                date: new Date().toISOString().split('T')[0]
            };
            
            sampleData.purchases.push(purchase);
            
            // Update product quantity and purchase price
            product.quantity += quantity;
            product.purchasePrice = price;
            
            // Save data
            saveDataToStorage();
            
            // Reset form
            purchaseProductSearch.value = '';
            purchaseQuantity.value = '';
            purchasePrice.value = '';
            purchaseProductSuggestions.style.display = 'none';
            
            // Update displays
            updatePurchasesTable();
            updateInventoryTable();
            updateDashboard();
            
            showAlert('کڕین بە سەرکەوتویی تۆمار کرا!', 'success');
        }

        // Add customer - گۆڕانکاری لێرە
        function addCustomer() {
            const name = customerName.value;
            const phone = customerPhone.value;
            const initialDebt = parseFloat(customerInitialDebt.value) || 0;
            
            if (!name) {
                showAlert('تکایە ناوی کەس بنووسە!', 'danger');
                return;
            }
            
            // Check if customer with same name already exists
            const existingCustomer = sampleData.customers.find(c => c.name === name);
            
            if (existingCustomer) {
                showAlert('کەس بەم ناوە هەیە!', 'danger');
                return;
            }
            
            // Create new customer
            const customer = {
                id: sampleData.customers.length + 1,
                name,
                phone,
                receipt: `R${String(sampleData.customers.length + 1).padStart(3, '0')}`,
                debt: initialDebt
            };
            
            sampleData.customers.push(customer);
            
            // Save data
            saveDataToStorage();
            
            // Reset form
            customerName.value = '';
            customerPhone.value = '';
            customerInitialDebt.value = '0';
            
            // Update displays
            updateCustomersTable();
            updateDashboard();
            
            showAlert('کەس بە سەرکەوتویی زیاد کرا!', 'success');
        }

        // Save system settings
        function saveSystemSettings() {
            const name = systemNameInput.value;
            
            if (!name) {
                showAlert('تکایە ناوی سیستەم بنووسە!', 'danger');
                return;
            }
            
            sampleData.system.name = name;
            systemName.textContent = name;
            
            // Handle logo upload
            const logoFile = systemLogo.files[0];
            if (logoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    sampleData.system.logo = e.target.result;
                    saveDataToStorage();
                    showAlert('رێکخستنەکان بە سەرکەوتویی پاشکەوت کرا!', 'success');
                };
                reader.readAsDataURL(logoFile);
            } else {
                saveDataToStorage();
                showAlert('رێکخستنەکان بە سەرکەوتویی پاشکەوت کرا!', 'success');
            }
        }

        // Change password
        function changePassword() {
            const current = currentPassword.value;
            const newPass = newPassword.value;
            const confirm = confirmPassword.value;
            
            if (!current || !newPass || !confirm) {
                showAlert('تکایە هەموو خانەکان پڕ بکەرەوە!', 'danger');
                return;
            }
            
            if (newPass !== confirm) {
                showAlert('پاسوۆردە نوێیەکان یەک ناخوێننەوە!', 'danger');
                return;
            }
            
            if (current !== currentUser.password) {
                showAlert('پاسوۆردی ئێستا هەڵەیە!', 'danger');
                return;
            }
            
            // Update password
            currentUser.password = newPass;
            
            // Save data
            saveDataToStorage();
            
            // Reset form
            currentPassword.value = '';
            newPassword.value = '';
            confirmPassword.value = '';
            
            showAlert('پاسوۆرد بە سەرکەوتویی گۆڕدرا!', 'success');
        }

        // Backup data
        function backupData() {
            const dataStr = JSON.stringify(sampleData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `market_system_backup_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showAlert('باکەپ بە سەرکەوتویی وەشاندرا!', 'success');
        }

        // Restore data
        function restoreData() {
            const file = restoreBackup.files[0];
            
            if (!file) {
                showAlert('تکایە فایلێکی باکەپ هەڵبژێرە!', 'danger');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const restoredData = JSON.parse(e.target.result);
                    Object.assign(sampleData, restoredData);
                    saveDataToStorage();
                    updateAllDisplays();
                    showAlert('باکەپ بە سەرکەوتویی گەڕێندرایەوە!', 'success');
                } catch (error) {
                    showAlert('فایلەکە دروست نیە!', 'danger');
                }
            };
            reader.readAsText(file);
        }

        // Add user
        function addUser() {
            const username = newUsername.value;
            const password = newUserPassword.value;
            const role = newUserRole.value;
            
            if (!username || !password) {
                showAlert('تکایە هەموو خانەکان پڕ بکەرەوە!', 'danger');
                return;
            }
            
            // Check if user with same username already exists
            const existingUser = sampleData.users.find(u => u.username === username);
            
            if (existingUser) {
                showAlert('بەکارهێنەر بەم ناوە هەیە!', 'danger');
                return;
            }
            
            // Create new user
            const user = {
                username,
                password,
                role
            };
            
            sampleData.users.push(user);
            
            // Save data
            saveDataToStorage();
            
            // Reset form
            newUsername.value = '';
            newUserPassword.value = '';
            newUserRole.value = 'user';
            
            // Update displays
            updateUsersTable();
            
            showAlert('بەکارهێنەر بە سەرکەوتویی زیاد کرا!', 'success');
        }

        // Show payment modal for any customer
        function showPaymentModalForAnyCustomer() {
            paymentModalBody.innerHTML = `
                <div class="form-container">
                    <h3>پارە وەسڵکردن</h3>
                    <div class="form-group">
                        <label for="paymentCustomerSearch">گەڕان بەدوای کەس</label>
                        <div class="search-container">
                            <input type="text" id="paymentCustomerSearch" class="search-input" placeholder="ناوی کەس...">
                            <span class="search-icon"><i class="fas fa-search"></i></span>
                        </div>
                        <div id="paymentCustomerSuggestions" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; display: none;">
                            <!-- Customer suggestions will appear here -->
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="paymentAmount">بڕی پارە</label>
                        <input type="number" id="paymentAmount" class="form-control" placeholder="بڕی پارە">
                    </div>
                    <div id="currentDebtInfo" style="display: none; padding: 10px; background: #f8f9fa; border-radius: 4px; margin-top: 10px;">
                        <strong>قەرزی ئێستا: <span id="currentDebtAmount">0</span> دینار</strong>
                    </div>
                </div>
            `;
            
            paymentModal.style.display = 'flex';
            
            // Set up customer search
            const paymentCustomerSearch = document.getElementById('paymentCustomerSearch');
            const paymentCustomerSuggestions = document.getElementById('paymentCustomerSuggestions');
            
            paymentCustomerSearch.addEventListener('input', () => {
                const query = paymentCustomerSearch.value.toLowerCase();
                
                if (query.length === 0) {
                    paymentCustomerSuggestions.style.display = 'none';
                    document.getElementById('currentDebtInfo').style.display = 'none';
                    return;
                }
                
                const filteredCustomers = sampleData.customers.filter(customer => 
                    customer.name.toLowerCase().includes(query)
                );
                
                displayPaymentCustomerSuggestions(filteredCustomers);
            });
            
            // Set up confirm payment button
            confirmPaymentBtn.onclick = () => {
                const customerName = paymentCustomerSearch.value;
                const amount = parseFloat(document.getElementById('paymentAmount').value);
                
                if (!customerName) {
                    showAlert('تکایە ناوی کەس بنووسە!', 'danger');
                    return;
                }
                
                if (!amount || amount <= 0) {
                    showAlert('تکایە بڕێکی دروست بنووسە!', 'danger');
                    return;
                }
                
                const customer = sampleData.customers.find(c => c.name === customerName);
                if (!customer) {
                    showAlert('کەس نەدۆزرایەوە!', 'danger');
                    return;
                }
                
                if (amount > customer.debt) {
                    showAlert('بڕی پارەی وەسڵکراو نابێت زیاتر بێت لە قەرز!', 'danger');
                    return;
                }
                
                confirmPayment(customer.id, amount);
            };
        }

        // Display customer suggestions for payment
        function displayPaymentCustomerSuggestions(customers) {
            const container = document.getElementById('paymentCustomerSuggestions');
            container.innerHTML = '';
            
            if (customers.length === 0) {
                container.style.display = 'none';
                document.getElementById('currentDebtInfo').style.display = 'none';
                return;
            }
            
            customers.forEach(customer => {
                const div = document.createElement('div');
                div.style.padding = '10px';
                div.style.borderBottom = '1px solid #eee';
                div.style.cursor = 'pointer';
                div.innerHTML = `
                    <div><strong>${customer.name}</strong></div>
                    <div>قەرز: ${customer.debt} دینار</div>
                `;
                
                div.addEventListener('click', () => {
                    document.getElementById('paymentCustomerSearch').value = customer.name;
                    document.getElementById('currentDebtAmount').textContent = customer.debt.toLocaleString();
                    document.getElementById('currentDebtInfo').style.display = 'block';
                    container.style.display = 'none';
                });
                
                container.appendChild(div);
            });
            
            container.style.display = 'block';
        }

        // Confirm payment
        function confirmPayment(customerId, amount) {
            const customer = sampleData.customers.find(c => c.id === customerId);
            if (!customer) return;
            
            const previousDebt = customer.debt;
            customer.debt -= amount;
            
            // Record payment
            const payment = {
                id: sampleData.payments.length + 1,
                customerId,
                customerName: customer.name,
                date: new Date().toISOString().split('T')[0],
                amount,
                previousDebt,
                newDebt: customer.debt
            };
            
            sampleData.payments.push(payment);
            
            // Save data
            saveDataToStorage();
            
            // Update displays
            updateDashboard();
            updateDebtorsTable();
            updateCustomersTable();
            
            // Close modal
            paymentModal.style.display = 'none';
            
            showAlert('پارە وەسڵکرا بە سەرکەوتویی!', 'success');
        }

        // Show payment history
        function showPaymentHistory() {
            paymentHistoryModalBody.innerHTML = `
                <div class="table-container">
                    <h3 style="padding: 15px; background: var(--light);">
                        <i class="fas fa-history"></i> مێژووی پارە وەسڵ کردن
                    </h3>
                    <div class="search-container" style="margin: 15px;">
                        <input type="text" id="paymentHistorySearch" class="search-input" placeholder="گەڕان بەدوای ناوی کەس...">
                        <span class="search-icon"><i class="fas fa-search"></i></span>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>کەس</th>
                                <th>بڕی پارە</th>
                                <th>قەرزی پێشتر</th>
                                <th>قەرزی دواتر</th>
                                <th>بەروار</th>
                                <th>کردارەکان</th>
                            </tr>
                        </thead>
                        <tbody id="paymentHistoryTable">
                            <!-- Payment history will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            `;
            
            paymentHistoryModal.style.display = 'flex';
            updatePaymentHistoryTable();
            
            // Set up search functionality
            const paymentHistorySearch = document.getElementById('paymentHistorySearch');
            paymentHistorySearch.addEventListener('input', updatePaymentHistoryTable);
        }

        // Update payment history table
        function updatePaymentHistoryTable() {
            const paymentHistoryTable = document.getElementById('paymentHistoryTable');
            paymentHistoryTable.innerHTML = '';
            
            const query = document.getElementById('paymentHistorySearch').value.toLowerCase();
            let filteredPayments = sampleData.payments;
            
            if (query) {
                filteredPayments = sampleData.payments.filter(payment => 
                    payment.customerName.toLowerCase().includes(query)
                );
            }
            
            if (filteredPayments.length === 0) {
                paymentHistoryTable.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px;">
                            هیچ پارە وەسڵکردنێک نەدۆزرایەوە
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredPayments.reverse().forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${payment.customerName}</td>
                    <td>${payment.amount.toLocaleString()} دینار</td>
                    <td>${payment.previousDebt.toLocaleString()} دینار</td>
                    <td>${payment.newDebt.toLocaleString()} دینار</td>
                    <td>${payment.date}</td>
                    <td>
                        <button class="btn print-payment-receipt" data-id="${payment.id}">
                            <i class="fas fa-print"></i> چاپکردن
                        </button>
                        <button class="btn btn-danger delete-payment" data-id="${payment.id}">
                            <i class="fas fa-trash"></i> سڕینەوە
                        </button>
                    </td>
                `;
                
                paymentHistoryTable.appendChild(row);
                
                // Add event listener for print button
                const printBtn = row.querySelector('.print-payment-receipt');
                printBtn.addEventListener('click', () => {
                    printPaymentReceipt(payment.id);
                });
                
                // Add event listener for delete button
                const deleteBtn = row.querySelector('.delete-payment');
                deleteBtn.addEventListener('click', () => {
                    deletePayment(payment.id);
                });
            });
        }

        // Print payment receipt
        function printPaymentReceipt(paymentId) {
            const payment = sampleData.payments.find(p => p.id === paymentId);
            if (!payment) return;
            
            const customer = sampleData.customers.find(c => c.id === payment.customerId);
            
            const receiptWindow = window.open('', '_blank');
            receiptWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ku" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>فاکتووری پارە وەسڵکردن</title>
                    <style>
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            line-height: 1.6;
                            color: #333;
                            max-width: 800px;
                            margin: 0 auto;
                            padding: 20px;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                            border-bottom: 2px solid #3498db;
                            padding-bottom: 20px;
                        }
                        .details {
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 20px;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 20px;
                        }
                        th, td {
                            padding: 10px;
                            text-align: right;
                            border-bottom: 1px solid #ddd;
                        }
                        th {
                            background-color: #f8f9fa;
                        }
                        .total {
                            text-align: left;
                            font-weight: bold;
                            font-size: 1.2rem;
                            margin-top: 20px;
                        }
                        @media print {
                            body { margin: 0; padding: 20px; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${sampleData.system.name}</h1>
                        <h2>فاکتووری پارە وەسڵکردن</h2>
                    </div>
                    <div class="details">
                        <div>
                            <p><strong>کەس:</strong> ${payment.customerName}</p>
                            <p><strong>بەروار:</strong> ${payment.date}</p>
                        </div>
                        <div>
                            <p><strong>کۆدی پارەدان:</strong> P${String(payment.id).padStart(3, '0')}</p>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>بڕی پارە</th>
                                <th>قەرزی پێشتر</th>
                                <th>قەرزی دواتر</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>${payment.amount.toLocaleString()} دینار</td>
                                <td>${payment.previousDebt.toLocaleString()} دینار</td>
                                <td>${payment.newDebt.toLocaleString()} دینار</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="total">
                        <p>کۆی پارەی وەسڵکراو: ${payment.amount.toLocaleString()} دینار</p>
                    </div>
                    <div style="margin-top: 50px; text-align: center;">
                        <p>___________________________________</p>
                        <p>واژۆ</p>
                    </div>
                    <button class="no-print" onclick="window.print()" style="margin-top: 20px; padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        چاپکردن
                    </button>
                </body>
                </html>
            `);
            receiptWindow.document.close();
        }

        // Delete payment
        function deletePayment(paymentId) {
            if (confirm('دڵنیای لە سڕینەوەی ئەم پارە وەسڵکردنە؟')) {
                const payment = sampleData.payments.find(p => p.id === paymentId);
                if (payment) {
                    // Restore customer debt
                    const customer = sampleData.customers.find(c => c.id === payment.customerId);
                    if (customer) {
                        customer.debt += payment.amount;
                    }
                    
                    // Remove payment
                    sampleData.payments = sampleData.payments.filter(p => p.id !== paymentId);
                    
                    // Save data
                    saveDataToStorage();
                    
                    // Update displays
                    updatePaymentHistoryTable();
                    updateDashboard();
                    updateCustomersTable();
                    
                    showAlert('پارە وەسڵکردن سڕدرایەوە!', 'success');
                }
            }
        }

        // Print payment history
        function printPaymentHistory() {
            window.print();
        }

        // Update all displays
        function updateAllDisplays() {
            updateDashboard();
            updateSalesHistory();
            updateInventoryTable();
            updatePurchasesTable();
            updateCustomersTable();
            updateUsersTable();
        }

        // Update dashboard
        function updateDashboard() {
            // Calculate totals
            const totalSalesAmount = sampleData.sales.reduce((sum, sale) => sum + sale.total, 0);
            const totalPurchasesAmount = sampleData.purchases.reduce((sum, purchase) => sum + purchase.total, 0);
            const totalDebtAmount = sampleData.customers.reduce((sum, customer) => sum + customer.debt, 0);
            const totalProductsCount = sampleData.products.length;
            
            // Update display
            totalSales.textContent = `${totalSalesAmount.toLocaleString()} دینار`;
            totalPurchases.textContent = `${totalPurchasesAmount.toLocaleString()} دینار`;
            totalDebt.textContent = `${totalDebtAmount.toLocaleString()} دینار`;
            totalProducts.textContent = totalProductsCount;
            
            // Update tab content
            if (currentTab === 'debtors') {
                updateDebtorsTable();
            } else if (currentTab === 'recentSales') {
                updateRecentSalesTable();
            } else if (currentTab === 'lowStock') {
                updateLowStockTable();
            }
        }

        // Update debtors table
        function updateDebtorsTable() {
            debtorsTable.innerHTML = '';
            
            const debtors = sampleData.customers.filter(customer => customer.debt > 0);
            
            if (debtors.length === 0) {
                debtorsTable.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 20px;">
                            هیچ کەسێک قەرزدار نیە
                        </td>
                    </tr>
                `;
                return;
            }
            
            debtors.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${customer.receipt}</td>
                    <td>${customer.debt.toLocaleString()} دینار</td>
                    <td>
                        <button class="btn btn-success pay-debt" data-id="${customer.id}">
                            <i class="fas fa-money-bill-wave"></i> پارە وەسڵکردن
                        </button>
                    </td>
                `;
                
                debtorsTable.appendChild(row);
                
                // Add event listener for pay debt button
                const payBtn = row.querySelector('.pay-debt');
                payBtn.addEventListener('click', () => {
                    showPaymentModalForCustomer(customer.id);
                });
            });
        }

        // Show payment modal for specific customer
        function showPaymentModalForCustomer(customerId) {
            const customer = sampleData.customers.find(c => c.id === customerId);
            if (!customer) return;
            
            paymentModalBody.innerHTML = `
                <div class="form-container">
                    <h3>پارە وەسڵکردن بۆ ${customer.name}</h3>
                    <div class="form-group">
                        <label for="paymentAmount">بڕی پارە</label>
                        <input type="number" id="paymentAmount" class="form-control" placeholder="بڕی پارە" max="${customer.debt}" value="${customer.debt}">
                        <small>قەرزی ئێستا: ${customer.debt.toLocaleString()} دینار</small>
                    </div>
                </div>
            `;
            
            paymentModal.style.display = 'flex';
            
            // Set up confirm payment button
            confirmPaymentBtn.onclick = () => {
                const amount = parseFloat(document.getElementById('paymentAmount').value);
                if (!amount || amount <= 0) {
                    showAlert('تکایە بڕێکی دروست بنووسە!', 'danger');
                    return;
                }
                
                if (amount > customer.debt) {
                    showAlert('بڕی پارەی وەسڵکراو نابێت زیاتر بێت لە قەرز!', 'danger');
                    return;
                }
                
                confirmPayment(customerId, amount);
            };
        }

        // Update recent sales table
        function updateRecentSalesTable() {
            recentSalesTable.innerHTML = '';
            
            const recentSales = sampleData.sales.slice(-5).reverse();
            
            if (recentSales.length === 0) {
                recentSalesTable.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 20px;">
                            هیچ فرۆشتنێک نیە
                        </td>
                    </tr>
                `;
                return;
            }
            
            recentSales.forEach(sale => {
                const customer = sale.customerId ? 
                    sampleData.customers.find(c => c.id === sale.customerId) : 
                    { name: 'نەقدی' };
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>F${String(sale.id).padStart(3, '0')}</td>
                    <td>${customer.name}</td>
                    <td>${sale.total.toLocaleString()} دینار</td>
                    <td>${sale.date}</td>
                `;
                
                recentSalesTable.appendChild(row);
            });
        }

        // Update low stock table
        function updateLowStockTable() {
            lowStockTable.innerHTML = '';
            
            const lowStockProducts = sampleData.products.filter(product => product.quantity < 10);
            
            if (lowStockProducts.length === 0) {
                lowStockTable.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 20px;">
                            هیچ کاڵایەک کەم نیە
                        </td>
                    </tr>
                `;
                return;
            }
            
            lowStockProducts.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>
                        <span class="badge ${product.quantity < 5 ? 'badge-danger' : 'badge-warning'}">
                            ${product.quantity} ${product.unit}
                        </span>
                    </td>
                    <td>${product.unit}</td>
                    <td>
                        <button class="btn btn-info purchase-product" data-id="${product.id}">
                            <i class="fas fa-shopping-bag"></i> کڕین
                        </button>
                    </td>
                `;
                
                lowStockTable.appendChild(row);
                
                // Add event listener for purchase button
                const purchaseBtn = row.querySelector('.purchase-product');
                purchaseBtn.addEventListener('click', () => {
                    // In a real application, this would open a purchase form
                    showAlert(`کڕینی ${product.name}`, 'info');
                });
            });
        }

        // Update sales history
        function updateSalesHistory() {
            salesHistoryTable.innerHTML = '';
            
            const query = salesHistorySearch.value.toLowerCase();
            let filteredSales = sampleData.sales;
            
            if (query) {
                filteredSales = sampleData.sales.filter(sale => {
                    const customer = sale.customerId ? 
                        sampleData.customers.find(c => c.id === sale.customerId) : 
                        { name: 'نەقدی' };
                    
                    return customer.name.toLowerCase().includes(query) || 
                           `F${String(sale.id).padStart(3, '0')}`.includes(query);
                });
            }
            
            if (filteredSales.length === 0) {
                salesHistoryTable.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px;">
                            هیچ فرۆشتنێک نەدۆزرایەوە
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredSales.reverse().forEach(sale => {
                const customer = sale.customerId ? 
                    sampleData.customers.find(c => c.id === sale.customerId) : 
                    { name: 'نەقدی' };
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>F${String(sale.id).padStart(3, '0')}</td>
                    <td>${customer.name}</td>
                    <td>${sale.total.toLocaleString()} دینار</td>
                    <td>${sale.date}</td>
                    <td>
                        <span class="badge ${sale.paymentMethod === 'cash' ? 'badge-success' : 'badge-warning'}">
                            ${sale.paymentMethod === 'cash' ? 'نەقدی' : 'قەرز'}
                        </span>
                    </td>
                    <td>
                        <button class="btn view-invoice" data-id="${sale.id}">
                            <i class="fas fa-eye"></i> بینین
                        </button>
                        <button class="btn btn-warning edit-invoice" data-id="${sale.id}">
                            <i class="fas fa-edit"></i> دەستکاری
                        </button>
                    </td>
                `;
                
                salesHistoryTable.appendChild(row);
                
                // Add event listener for view button
                const viewBtn = row.querySelector('.view-invoice');
                viewBtn.addEventListener('click', () => {
                    viewInvoice(sale.id);
                });
                
                // Add event listener for edit button
                const editBtn = row.querySelector('.edit-invoice');
                editBtn.addEventListener('click', () => {
                    editInvoice(sale.id);
                });
            });
        }

        // Update inventory table
        function updateInventoryTable() {
            inventoryTable.innerHTML = '';
            
            const query = inventorySearch.value.toLowerCase();
            let filteredProducts = sampleData.products;
            
            if (query) {
                filteredProducts = sampleData.products.filter(product => 
                    product.name.toLowerCase().includes(query) || 
                    product.barcode.includes(query)
                );
            }
            
            if (filteredProducts.length === 0) {
                inventoryTable.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">
                            هیچ کاڵایەک نەدۆزرایەوە
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredProducts.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.barcode}</td>
                    <td>
                        <span class="badge ${product.quantity < 10 ? 'badge-danger' : 'badge-success'}">
                            ${product.quantity} ${product.unit}
                        </span>
                    </td>
                    <td>${product.unit}</td>
                    <td>${product.purchasePrice.toLocaleString()} دینار</td>
                    <td>${product.salePrice.toLocaleString()} دینار</td>
                    <td>
                        <button class="btn btn-warning edit-product" data-id="${product.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger delete-product" data-id="${product.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                inventoryTable.appendChild(row);
                
                // Add event listeners for edit and delete buttons
                const editBtn = row.querySelector('.edit-product');
                editBtn.addEventListener('click', () => {
                    // In a real application, this would open an edit form
                    showAlert(`دەستکاری ${product.name}`, 'info');
                });
                
                const deleteBtn = row.querySelector('.delete-product');
                deleteBtn.addEventListener('click', () => {
                    if (confirm(`دڵنیای لە سڕینەوەی ${product.name}؟`)) {
                        sampleData.products = sampleData.products.filter(p => p.id !== product.id);
                        saveDataToStorage();
                        updateInventoryTable();
                        updateDashboard();
                        showAlert('کاڵا سڕدرایەوە!', 'success');
                    }
                });
            });
        }

        // Update purchases table
        function updatePurchasesTable() {
            purchasesTable.innerHTML = '';
            
            if (sampleData.purchases.length === 0) {
                purchasesTable.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px;">
                            هیچ کڕینێک نیە
                        </td>
                    </tr>
                `;
                return;
            }
            
            sampleData.purchases.reverse().forEach(purchase => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${purchase.productName}</td>
                    <td>${purchase.quantity} ${purchase.unit}</td>
                    <td>${purchase.price.toLocaleString()} دینار</td>
                    <td>${purchase.total.toLocaleString()} دینار</td>
                    <td>${purchase.date}</td>
                    <td>
                        <button class="btn btn-danger delete-purchase" data-id="${purchase.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                purchasesTable.appendChild(row);
                
                // Add event listener for delete button
                const deleteBtn = row.querySelector('.delete-purchase');
                deleteBtn.addEventListener('click', () => {
                    if (confirm('دڵنیای لە سڕینەوەی ئەم کڕینە؟')) {
                        sampleData.purchases = sampleData.purchases.filter(p => p.id !== purchase.id);
                        saveDataToStorage();
                        updatePurchasesTable();
                        updateDashboard();
                        showAlert('کڕین سڕدرایەوە!', 'success');
                    }
                });
            });
        }

        // Update customers table
        function updateCustomersTable() {
            customersTable.innerHTML = '';
            
            const query = customersSearch.value.toLowerCase();
            let filteredCustomers = sampleData.customers;
            
            if (query) {
                filteredCustomers = sampleData.customers.filter(customer => 
                    customer.name.toLowerCase().includes(query) ||
                    customer.receipt.includes(query)
                );
            }
            
            if (filteredCustomers.length === 0) {
                customersTable.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 20px;">
                            هیچ کەسێک نەدۆزرایەوە
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredCustomers.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${customer.receipt}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.debt.toLocaleString()} دینار</td>
                    <td>
                        <button class="btn btn-warning edit-customer" data-id="${customer.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger delete-customer" data-id="${customer.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                customersTable.appendChild(row);
                
                // Add event listeners for edit and delete buttons
                const editBtn = row.querySelector('.edit-customer');
                editBtn.addEventListener('click', () => {
                    editCustomer(customer.id);
                });
                
                const deleteBtn = row.querySelector('.delete-customer');
                deleteBtn.addEventListener('click', () => {
                    if (confirm(`دڵنیای لە سڕینەوەی ${customer.name}؟`)) {
                        sampleData.customers = sampleData.customers.filter(c => c.id !== customer.id);
                        saveDataToStorage();
                        updateCustomersTable();
                        updateDashboard();
                        showAlert('کەس سڕدرایەوە!', 'success');
                    }
                });
            });
        }

        // Update users table
        function updateUsersTable() {
            usersTable.innerHTML = '';
            
            sampleData.users.forEach(user => {
                // Don't show current user in the list (can't delete yourself)
                if (user.username === currentUser.username) return;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td><span class="user-role">${user.role === 'admin' ? 'ئەدمین' : 'بەکارهێنەر'}</span></td>
                    <td>
                        <button class="btn btn-warning edit-user" data-username="${user.username}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger delete-user" data-username="${user.username}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                usersTable.appendChild(row);
                
                // Add event listeners for edit and delete buttons
                const editBtn = row.querySelector('.edit-user');
                editBtn.addEventListener('click', () => {
                    // In a real application, this would open an edit form
                    showAlert(`دەستکاری ${user.username}`, 'info');
                });
                
                const deleteBtn = row.querySelector('.delete-user');
                deleteBtn.addEventListener('click', () => {
                    if (confirm(`دڵنیای لە سڕینەوەی ${user.username}؟`)) {
                        sampleData.users = sampleData.users.filter(u => u.username !== user.username);
                        saveDataToStorage();
                        updateUsersTable();
                        showAlert('بەکارهێنەر سڕدرایەوە!', 'success');
                    }
                });
            });
        }

        // View invoice
        function viewInvoice(invoiceId) {
            const sale = sampleData.sales.find(s => s.id === invoiceId);
            if (!sale) return;
            
            const customer = sale.customerId ? 
                sampleData.customers.find(c => c.id === sale.customerId) : 
                { name: 'نەقدی', receipt: 'N/A' };
            
            invoiceModalBody.innerHTML = `
                <div class="invoice">
                    <div class="invoice-header">
                        <h2>${sampleData.system.name}</h2>
                        <p>فاکتووری فرۆشتن</p>
                    </div>
                    <div class="invoice-details">
                        <div>
                            <p><strong>کۆدی فاکتوور:</strong> F${String(sale.id).padStart(3, '0')}</p>
                            <p><strong>کەس:</strong> ${customer.name}</p>
                        </div>
                        <div>
                            <p><strong>رەسید:</strong> ${customer.receipt}</p>
                            <p><strong>بەروار:</strong> ${sale.date}</p>
                        </div>
                    </div>
                    <table class="invoice-items">
                        <thead>
                            <tr>
                                <th>کاڵا</th>
                                <th>بڕ</th>
                                <th>نرخ</th>
                                <th>کۆی</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sale.items.map(item => `
                                <tr>
                                    <td>${item.name}</td>
                                    <td>${item.quantity} ${item.unit}</td>
                                    <td>${item.price.toLocaleString()} دینار</td>
                                    <td>${item.total.toLocaleString()} دینار</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <div class="invoice-total">
                        <p>کۆی گشتی: ${sale.total.toLocaleString()} دینار</p>
                        <p>شێوازی پارەدان: ${sale.paymentMethod === 'cash' ? 'نەقدی' : 'قەرز'}</p>
                    </div>
                </div>
            `;
            
            invoiceModal.style.display = 'flex';
            editingInvoiceId = invoiceId;
        }

        // Edit invoice
        function editInvoice(invoiceId) {
            // In a real application, this would open an edit form
            showAlert('دەستکاری فاکتوور', 'info');
        }

        // Delete invoice
        function deleteInvoice() {
            if (!editingInvoiceId) return;
            
            if (confirm('دڵنیای لە سڕینەوەی ئەم فاکتوورە؟')) {
                sampleData.sales = sampleData.sales.filter(s => s.id !== editingInvoiceId);
                saveDataToStorage();
                updateSalesHistory();
                updateDashboard();
                invoiceModal.style.display = 'none';
                showAlert('فاکتوور سڕدرایەوە!', 'success');
            }
        }

        // Print invoice
        function printInvoice() {
            // In a real application, this would open a print dialog with the invoice formatted for printing
            window.print();
        }

        // Edit customer
        function editCustomer(customerId) {
            const customer = sampleData.customers.find(c => c.id === customerId);
            if (!customer) return;
            
            currentEditingCustomerId = customerId;
            
            // In a real application, this would open an edit form
            // For now, we'll just show a simple prompt for debt adjustment
            const newDebt = prompt(`قەرزی نوێ بۆ ${customer.name}:`, customer.debt);
            
            if (newDebt !== null && !isNaN(newDebt)) {
                customer.debt = parseFloat(newDebt);
                saveDataToStorage();
                updateCustomersTable();
                updateDashboard();
                showAlert('قەرز بە سەرکەوتویی نوێکرایەوە!', 'success');
            }
        }

        // Show alert
        function showAlert(message, type) {
            // Create alert element
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <span>${message}</span>
                <button style="float: left; background: none; border: none; font-size: 1.2rem;">&times;</button>
            `;
            
            // Add to page
            document.querySelector('.main-content').prepend(alert);
            
            // Add event listener to close button
            const closeBtn = alert.querySelector('button');
            closeBtn.addEventListener('click', () => {
                alert.remove();
            });
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }

        // Initialize the application when the DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>